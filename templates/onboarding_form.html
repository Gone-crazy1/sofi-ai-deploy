<!DOCTYPE html>
<html>
<head>
    <title>Sofi AI Onboarding</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f7f7f7; }
        form { background: white; padding: 20px; border-radius: 10px; max-width: 500px; margin: auto; }
        input, select { display: block; margin-top: 10px; padding: 10px; width: 100%; }
        button { margin-top: 20px; padding: 10px; background: #005eff; color: white; border: none; width: 100%; }
        .return-button { display: block; margin-top: 10px; padding: 10px; background: #0088cc; color: white; text-align: center; border-radius: 5px; text-decoration: none; }
    </style>
</head>
<body>
    <h2>ðŸš€ Sofi AI - Open Your Account</h2>
    <form action="/onboard" method="POST">
        <input name="first_name" placeholder="First Name" required>
        <input name="last_name" placeholder="Last Name" required>
        <input name="address" placeholder="Address" required>
        <input name="city" placeholder="City" required>
        <input name="state" placeholder="State" required>
        <input name="bvn" placeholder="BVN" required>
        <input name="pin" placeholder="Create 4-digit PIN" minlength="4" maxlength="4" required>
        <input type="hidden" name="chat_id" value="{{ chat_id }}">
        <button type="submit">Create My Account</button>
    </form>

    <script>
        document.querySelector('form').addEventListener('submit', function(event) {
            event.preventDefault();  // Prevent default submit

            const pinInput = document.querySelector('input[name="pin"]');
            const encoder = new TextEncoder();
            const data = encoder.encode(pinInput.value);

            crypto.subtle.digest('SHA-256', data).then(hashBuffer => {
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                pinInput.value = hashHex;  // Replace PIN with hash

                event.target.submit();  // Now submit the form
            });
        });

        const tg = window.Telegram.WebApp;
        document.querySelector('input[name="chat_id"]').value = tg.initDataUnsafe.user.id;
    </script>

    <a href="https://t.me/getsofi_bot" class="return-button">Return to Telegram</a>
</body>
</html>
